<!DOCTYPE html>
<html lang="zh_CN" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link th:href="@{/css/font-family.css}" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Poppins:100,200,300,400,500,600,700,800,900&subset=devanagari,latin-ext"
          rel="stylesheet">
    <title>登录页 - CodingHub</title>
    <link rel="stylesheet" th:href="@{/css/font-awesome.min.css}">
    <link rel="stylesheet" th:href="@{/css/animate.css}">
    <link rel="stylesheet" th:href="@{/css/bootstrap.min.css}">
    <link rel="stylesheet" th:href="@{/css/bootsnav.css}">
    <link rel="stylesheet" th:href="@{/css/sign.css}">
    <link rel="stylesheet" th:href="@{/css/responsive.css}">
</head>
<body>
<section class="signin popup-in">
    <div class="container">
        <div class="sign-content popup-in-content">
            <div class="popup-in-txt">
                <h2 class="h2">登录</h2>
                <form th:action="@{/user/login}" method="post" id="login-form">
                    <div class="container-fluid">
                        <div class="row">
                            <div class="col-xs-12">
                                <div class="signin-form">
                                    <div class="form-group">
                                        <label for="username">用户名</label>
                                        <input type="text" class="form-control" id="username" name="username"
                                               required placeholder="请输入你的用户名">
                                    </div><!--/.form-group -->
                                    <div class="form-group">
                                        <label for="password">密码</label>
                                        <input type="password" class="form-control" id="password" name="password"
                                               required placeholder="请输入你的密码">
                                    </div><!--/.form-group -->
                                    <div class="form-col">
                                        <div class="form-group">
                                            <label for="captchaCode">验证码</label>
                                            <input type="text" class="form-control" id="captchaCode" name="captchaCode"
                                                   required placeholder="请输入验证码">
                                        </div>
                                    </div>
                                    <div class="form-col1">
                                        <div class="form-group">
                                            <img class="pull-right" alt="验证码" onclick="this.src='/user/defaultCaptcha'" title="点击刷新"
                                                 th:src="@{/user/defaultCaptcha}" style="margin-top: 37px">
                                        </div>
                                    </div>
                                </div><!--/.signin-form -->
                            </div><!--/.col -->
                        </div><!--/.row -->
                        <div class="row">
                            <div class="col-xs-12">
                                <div class="signin-password">
                                    <div class="awesome-checkbox-list">
                                        <ul class="unstyled centered">
                                            <li>
                                                <input class="styled-checkbox" id="rememberMe" type="checkbox"
                                                       name="rememberMe">
                                                <label for="rememberMe">记住我</label>
                                            </li>
                                            <li>
                                                <a href="javascript:void(0);" data-toggle="modal" data-target="#forget">
                                                    忘记了你的账户或密码?
                                                </a>
                                            </li>
                                        </ul>
                                    </div><!--/.awesome-checkbox-list -->
                                </div><!--/.signin-password -->
                            </div><!--/.col -->
                        </div><!--/.row -->

                        <div class="row">
                            <div class="col-xs-12">
                                <div class="signin-footer">
                                    <button type="submit" id="login-btn" class="btn signin_btn">
                                        登录
                                    </button>
                                    <p>
                                        还没有账户?去
                                        <a th:href="@{/user/toRegister}">注册</a>
                                    </p>
                                    <p>
                                        <a th:href="@{/}">返回首页</a>
                                    </p>
                                </div><!--/.signin-footer -->
                            </div><!--/.col-->
                        </div><!--/.row -->
                    </div>
                </form><!--/form -->
                <div class="text-center signin-footer">
                    <p>
                        Copyright &copy; 2020 &middot; CodingHub问答社区 &middot;
                        服务器: 阿里云 &middot;
                        网站程序: <a href="https://github.com/zydse/CodingHub_Forum" target="_blank">CodingHub_Forum</a>
                        &middot;
                        <a target="_blank" href="http://www.beian.miit.gov.cn/">皖ICP备20003339号</a>
                    </p>
                </div>
            </div>
        </div>
        <div class="modal fade signin_modal" id="forget" tabindex="-1" role="dialog"
             aria-labelledby="myLargeModalLabel">
            <div class="modal-dialog modal-lg" role="document">
                <div class="modal-content">
                    <div class="sign-content">
                        <div class="modal-header">
                            <h2>找回密码</h2>
                        </div><!--/.modal-header -->
                        <div class="modal-body">
                            <div class="container-fluid">
                                <div class="signin-form">
                                    <div class=" ">
                                        <div class=" ">
                                            <form action="signin.html">
                                                <div class="form-group">
                                                    <label for="phone-number">手机号</label>
                                                    <input type="text" class="form-control" id="phone-number"
                                                           name="phone-number"
                                                           pattern="(\d{11})|(\d{3}-\d{4}-\d{4})$"
                                                           required placeholder="请输入注册手机号获得验证码">
                                                </div><!--/.form-group -->
                                                <div class="form-col">
                                                    <div class="form-group">
                                                        <label for="verify-code">验证码</label>
                                                        <input type="text" class="form-control" id="verify-code"
                                                               name="verify-code"
                                                               required maxlength="6" minlength="6"
                                                               placeholder="请输入你获得的验证码">
                                                    </div>
                                                </div>
                                                <div class="form-col1">
                                                    <div class="form-group">
                                                        <button type="button" id="code-btn"
                                                                class="btn btn_get pull-right">
                                                            获取验证码
                                                        </button>
                                                    </div>
                                                </div>
                                                <div class="clearfix"></div>
                                                <div class="form-group">
                                                    <label class="pull-left" for="newPassword">新密码</label>
                                                    <input type="password" class="form-control" name="newPassword"
                                                           id="newPassword" minlength="6" required
                                                           placeholder="请输入密码(至少6位)">
                                                </div>
                                                <div class="form-group">
                                                    <label for="password-retype">确认密码</label>
                                                    <input type="password" class="form-control" id="password-retype"
                                                           minlength="6" required placeholder="请重新输入密码">
                                                </div>
                                            </form><!--/form -->
                                        </div><!--/.col -->
                                    </div><!--/.row -->
                                </div><!--/.signin-form -->
                                <div class="signin-footer">
                                    <button type="button" class="btn signin_btn" data-toggle="modal"
                                            data-target=".signin_modal">
                                        重新设置密码
                                    </button>
                                </div><!--/.signin-footer -->
                            </div>
                        </div><!--/.modal-body -->
                    </div><!--/.sign-content -->
                </div><!--/.modal-content -->
            </div><!--/.modal-dialog -->
        </div><!--/.modal -->
        <!-- modal part end -->
        <!--/.sign-description -->

    </div><!--/.container -->
</section><!--/.signin -->
<div class="container">
    <div th:insert="fragment/alert :: modal"></div>
</div>

<script th:src="@{/js/jquery.js}"></script>
<script th:src="@{/js/modernizr.min.js}"></script>
<script th:src="@{/js/bootstrap.min.js}"></script>
<script th:src="@{/js/bootsnav.js}"></script>
<script th:src="@{/js/jquery.sticky.js}"></script>
<script th:src="@{/js/jquery.easing.min.js}"></script>
<script th:src="@{/js/jquery.md5.js}"></script>
<script>
    $("#login-form").submit(function (e) {
        e.preventDefault();
        var username = $("input#username").val();
        var password = $("input#password").val();
        var captchaCode = $("input#captchaCode").val();
        var rememberMe = $("input#rememberMe").prop("checked") ? 1 : 0;
        $.ajax({
            type: "POST",
            url: "/user/login",
            dataType: "json",
            data: {
                "username": username,
                "password": $.md5(password),
                "rememberMe": rememberMe,
                "captchaCode": captchaCode
            },
            success: function (result) {
                if (result.code !== 200) {
                    $(".modal-body").text(result.message);
                    $('#notice').modal('show');
                    return false;
                } else {
                    window.location = result.data;
                }
            }
        });
    });
</script>
</body>
</html>